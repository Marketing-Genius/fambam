<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Fambam ‚Äî Match</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#9ca3af;
    --accent:#22d3ee; --ok:#22c55e; --warn:#f59e0b;
    --card:#0b1326; --cardEdge:#2b3549; --flip:#111b33;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;}
  a{color:inherit;text-decoration:none}

  /* Top controls bar */
  .topbar{
    position:sticky; top:0; z-index:20; padding:10px 12px;
    background:rgba(10,16,30,.9); backdrop-filter: blur(8px);
    border-bottom:1px solid #1e2a3f;
  }
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{
    appearance:none;border:1px solid #2a3954;background:#111a2e;color:var(--ink);
    padding:8px 12px;border-radius:10px;cursor:pointer;font:inherit;
  }
  .btn[data-on="1"]{outline:2px solid var(--accent)}
  .pill{border-radius:999px;padding:6px 10px}
  .timer{min-width:74px;text-align:center;font-variant-numeric:tabular-nums}

  /* Player select bar */
  .pbar{padding:10px 12px;border-bottom:1px solid #142039;background:#0b1326}
  .pwrap{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap}
  .pcard{
    display:flex;align-items:center;gap:10px;padding:8px 12px;border:1px solid #26344e;
    background:#0e162b;border-radius:12px;cursor:pointer;min-width:140px;
  }
  .pcard[data-on="1"]{outline:2px solid var(--accent)}
  .avatar{width:28px;height:28px;border-radius:50%;display:grid;place-items:center;
    background:#14223e;border:1px solid #243a62;font-size:18px}
  .name{font-weight:600}

  /* Boards */
  .wrap{max-width:1200px;margin:18px auto;padding:0 12px}
  .boards{display:grid;gap:16px}
  @media (min-width:1000px){ .boards{grid-template-columns:1fr 1fr;} }
  .board{
    background:linear-gradient(180deg,#0c1429,#0a1326);border:1px solid #22314b;
    border-radius:14px;padding:14px 14px 18px;
  }
  .bhead{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .bmeta{color:var(--muted);font-size:14px}
  .grid{
    display:grid;gap:min(1.8vw,12px);
  }
  /* breakpoints: we compute columns in JS, but keep min max sizing nice */
  .cell{
    aspect-ratio:1/1;border-radius:14px;position:relative;perspective:900px;
    -webkit-tap-highlight-color: transparent;
  }
  .card{
    position:absolute;inset:0;border-radius:14px;border:1px solid var(--cardEdge);
    transform-style:preserve-3d;transition:transform .45s cubic-bezier(.2,.7,.2,1);
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
    background:linear-gradient(180deg,#0e1933,#0b162e);
  }
  .card.revealed{ transform:rotateY(180deg) }
  .face, .back{
    position:absolute;inset:0;border-radius:13px;display:grid;place-items:center;
    font-size:clamp(22px,6vw,40px);
    backface-visibility:hidden;-webkit-backface-visibility:hidden;
  }
  .back{
    background: radial-gradient(60% 80% at 50% 10%, #152547, #0f1a34);
    color:#9fb4ff;
  }
  .face{
    transform:rotateY(180deg); background:var(--card); color:#fff;
  }
  .match .face{ box-shadow:inset 0 0 0 3px rgba(34,197,94,.35) }
  .glow{box-shadow:0 0 0 2px rgba(34,211,238,.7), 0 8px 26px rgba(34,211,238,.25)}

  .footerlink{
    position:fixed;left:12px;bottom:12px;padding:8px 12px;border-radius:10px;
    background:#101a30;border:1px solid #243554;
  }

</style>
</head>
<body>

  <!-- TOP CONTROLS -->
  <div class="topbar">
    <div class="row" id="controls">
      <div class="row" role="group" aria-label="Mode">
        <button class="btn pill" data-mode="solo" data-on="1">Solo</button>
        <button class="btn pill" data-mode="versus">Versus</button>
      </div>
      <div class="row" role="group" aria-label="Difficulty">
        <button class="btn pill" data-diff="easy"  data-on="1">Easy</button>
        <button class="btn pill" data-diff="medium">Medium</button>
        <button class="btn pill" data-diff="hard">Hard</button>
      </div>
      <span class="timer" id="timer">0.0 s</span>
      <button class="btn" id="btnPlay">‚ñ∫ Play</button>
      <button class="btn" id="btnPause">‚è∏Ô∏é Pause</button>
      <button class="btn" id="btnReset">‚Ü∫ Reset</button>
    </div>
  </div>

  <!-- PLAYER SELECT -->
  <div class="pbar">
    <div class="pwrap" id="playerSelect"></div>
  </div>

  <!-- BOARDS -->
  <div class="wrap">
    <div class="boards" id="boards"></div>
  </div>

  <a class="footerlink" href="./games.html">‚Üê Games</a>

<script>
(()=>{

// ---------- Family roster ----------
const FAMILY = [
  { id:'adam',  name:'Adam',  emoji:'üßî' },
  { id:'mama',  name:'Mom',   emoji:'üë©' },
  { id:'dad',   name:'Dad',   emoji:'üë®' },
  { id:'kid1',  name:'Aiden', emoji:'üßí' },
  { id:'kid2',  name:'Mia',   emoji:'üëß' },
  { id:'kid3',  name:'Zoe',   emoji:'üë∂' },
];

// ---------- Emojis pool ----------
const EMOJIS = ("üçé üçí üçì üçâ ü•ù üçç üçå üçï üç™ üç© üçü üçî üåÆ üßÉ üç≠ üéà ü™Ä üß∏ üéÆ üïπÔ∏è üèÄ ‚öΩ üéØ üé≤ ‚úàÔ∏è üöó üöå üöÄ üê∂ üê± üêª üêº ü¶Å üêØ üê∏ üêß üê§ üê∑ üêµ üêî üêù üêô üêû üê¢ üê† üê¨ üåû üåõ ‚≠ê üåà ‚òÅÔ∏è üçÄ üåµ üå∑ üíé üß†").split(/\s+/);

// ---------- State ----------
const state = {
  mode:'solo',          // 'solo' | 'versus'
  diff:'easy',          // 'easy' | 'medium' | 'hard'
  players: ['adam','mama'], // left (or solo) + right
  running:false, startTime:0, elapsed:0,
};
const boardsEl = document.getElementById('boards');
const timerEl  = document.getElementById('timer');
let raf=0;

// ---------- Helpers ----------
const $ = sel => document.querySelector(sel);
function setButtons(groupAttr, value){
  document.querySelectorAll(`[data-${groupAttr}]`).forEach(b=>{
    b.dataset.on = (b.dataset[groupAttr]===value)?'1':'0';
  });
}
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
function now(){ return performance.now() }

// ---------- Timer ----------
function updateTimer(){
  if(state.running){
    const t = state.elapsed + (now()-state.startTime);
    timerEl.textContent = (t/1000).toFixed(1) + ' s';
  }
  raf = requestAnimationFrame(updateTimer);
}
function startTimer(){
  if(state.running) return;
  state.running = true;
  state.startTime = now();
}
function pauseTimer(){
  if(!state.running) return;
  state.elapsed += now()-state.startTime;
  state.running = false;
}
function resetTimer(){
  state.running=false; state.elapsed=0; state.startTime=0;
  timerEl.textContent='0.0 s';
}

// ---------- Build player select ----------
function renderPlayerSelect(){
  const wrap = document.getElementById('playerSelect');
  wrap.innerHTML='';
  const who = state.mode==='solo' ? [state.players[0]] : state.players;
  const selectedSet = new Set(who);
  FAMILY.forEach(p=>{
    const el = document.createElement('div');
    el.className='pcard';
    el.dataset.id=p.id;
    el.dataset.on = selectedSet.has(p.id)?'1':'0';
    el.innerHTML = `
      <div class="avatar">${p.emoji}</div>
      <div>
        <div class="name">${p.name}</div>
        <div style="font-size:12px;color:var(--muted)">${p.id}</div>
      </div>`;
    el.addEventListener('click', ()=>{
      if(state.mode==='solo'){
        state.players[0]=p.id;
      }else{
        // toggle into the less-recent slot
        if(el.dataset.on==='1'){ return; }
        // choose side based on whichever was changed last; here: left first, then right
        if(!state._lastSide || state._lastSide==='right'){ state.players[0]=p.id; state._lastSide='left'; }
        else { state.players[1]=p.id; state._lastSide='right'; }
      }
      renderPlayerSelect();
      buildBoards(); // update labels
    });
    wrap.appendChild(el);
  });

  // Highlight center when solo
  wrap.style.justifyContent = state.mode==='solo' ? 'center' : 'center';
}

// ---------- Game board factory ----------
function makeDeck(nPairs){
  const pick = shuffle([...EMOJIS]).slice(0,nPairs);
  const pairs = shuffle([...pick, ...pick]).map((emoji, idx)=>({
    id:'c'+idx, emoji, up:false, matched:false
  }));
  return pairs;
}
function boardSpecByDiff(diff){
  if(diff==='easy')   return {cols:4, rows:4, pairs:8};
  if(diff==='medium') return {cols:6, rows:4, pairs:12};
  return {cols:8, rows:4, pairs:16}; // hard
}

// Board object handles its own interactions
function buildBoard(side){ // 'left' | 'right' (or 'solo' uses 'left')
  const spec = boardSpecByDiff(state.diff);
  const deck = makeDeck(spec.pairs);
  const board = {
    el: document.createElement('section'),
    deck,
    first:null, lock:false, pairs:0, moves:0,
    owner: side==='right' ? state.players[1] : state.players[0],
  };
  board.el.className='board';
  board.el.innerHTML = `
    <div class="bhead">
      <div>
        <div style="font-weight:700">${side==='right'?'Player B':'Player' + (state.mode==='versus'?' A':'')}</div>
        <div class="bmeta"><span class="pairs">0</span> pairs ¬∑ <span class="moves">0</span> moves</div>
      </div>
      <div class="bmeta"><span class="btimer">0.0</span> s</div>
    </div>
    <div class="grid"></div>
  `;
  const grid = board.el.querySelector('.grid');

  // responsive columns
  grid.style.gridTemplateColumns = `repeat(${spec.cols}, 1fr)`;
  grid.style.gap = 'min(1.6vw,12px)';

  // build cells
  deck.forEach(card=>{
    const cell = document.createElement('div');
    cell.className='cell';
    cell.innerHTML = `
      <div class="card" data-id="${card.id}">
        <div class="back">üÇ†</div>
        <div class="face">${card.emoji}</div>
      </div>
    `;
    grid.appendChild(cell);
  });

  // click handling with event delegation
  grid.addEventListener('click', (e)=>{
    const cEl = e.target.closest('.card');
    if(!cEl || board.lock) return;
    const id = cEl.dataset.id;
    const c = deck.find(x=>x.id===id);
    if(!c || c.matched || c.up) return;

    c.up=true; cEl.classList.add('revealed','glow');
    if(!state.running) startTimer();

    if(!board.first){
      board.first = {c, el:cEl};
    }else{
      board.moves++; board.el.querySelector('.moves').textContent=board.moves;
      board.lock=true;
      if(board.first.c.emoji===c.emoji){
        // match
        c.matched = board.first.c.matched = true;
        cEl.classList.add('match'); board.first.el.classList.add('match');
        setTimeout(()=>{ cEl.classList.remove('glow'); board.first.el.classList.remove('glow'); }, 300);
        board.first=null; board.lock=false; board.pairs++;
        board.el.querySelector('.pairs').textContent=board.pairs;
        if(board.pairs===spec.pairs){
          // board finished
          if(state.mode==='solo'){ pauseTimer(); saveScore('solo'); }
          else{
            // if both boards done ‚Üí stop
            const otherDone = [...boardsEl.children].every(b=>b.querySelector('.pairs').textContent==spec.pairs);
            if(otherDone){ pauseTimer(); saveScore('versus'); }
          }
        }
      }else{
        // flip both back
        setTimeout(()=>{
          c.up=false; board.first.c.up=false;
          cEl.classList.remove('revealed','glow');
          board.first.el.classList.remove('revealed','glow');
          board.first=null; board.lock=false;
        }, 600);
      }
    }
  });

  // update local per-board timer readout from global timer
  board._tick = () => {
    const total = state.elapsed + (state.running?(now()-state.startTime):0);
    board.el.querySelector('.btimer').textContent = (total/1000).toFixed(1);
  };

  return board;
}

let boards=[];

function buildBoards(){
  boardsEl.innerHTML='';
  boards = [];
  if(state.mode==='solo'){
    boardsEl.style.gridTemplateColumns='1fr';
    const B = buildBoard('left');
    boards.push(B); boardsEl.appendChild(B.el);
  }else{
    boardsEl.style.gridTemplateColumns='1fr 1fr';
    const L = buildBoard('left');
    const R = buildBoard('right');
    boards.push(L,R);
    boardsEl.appendChild(L.el); boardsEl.appendChild(R.el);
  }
  // ensure everything fits vertically by letting cells shrink; grid gaps already responsive
}

// ---------- Leaderboard (localStorage minimal) ----------
function saveScore(mode){
  try{
    const key = `match_${mode}_${state.diff}`;
    const rec = JSON.parse(localStorage.getItem(key)||'[]');
    const who = state.mode==='solo' ? state.players[0] : `${state.players[0]} vs ${state.players[1]}`;
    rec.push({ t: +(timerEl.textContent.replace(' s','')), who, at: Date.now() });
    rec.sort((a,b)=>a.t-b.t);
    localStorage.setItem(key, JSON.stringify(rec.slice(0,10)));
  }catch(e){}
}

// ---------- Wire controls ----------
document.getElementById('btnPlay').onclick = ()=> startTimer();
document.getElementById('btnPause').onclick = ()=> pauseTimer();
document.getElementById('btnReset').onclick = ()=>{
  pauseTimer(); resetTimer(); buildBoards();
};

document.querySelectorAll('[data-mode]').forEach(b=>{
  b.addEventListener('click', ()=>{
    state.mode = b.dataset.mode;
    setButtons('mode', state.mode);
    renderPlayerSelect();
    pauseTimer(); resetTimer();
    buildBoards();
  });
});
document.querySelectorAll('[data-diff]').forEach(b=>{
  b.addEventListener('click', ()=>{
    state.diff = b.dataset.diff;
    setButtons('diff', state.diff);
    pauseTimer(); resetTimer();
    buildBoards();
  });
});

// ---------- Init ----------
renderPlayerSelect();
buildBoards();
updateTimer();

})();
</script>
</body>
</html>