<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fambam · Chores</title>

<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.webmanifest">

<!-- Shared wallpaper + tokens -->
<link rel="stylesheet" href="wallpaper.css">
<script src="wallpaper.js" defer></script>

<!-- Shared app styles -->
<link rel="stylesheet" href="fambam.css">

<!-- THEME BOOT (same as other pages) -->
<script>
(function themeBoot(){
  try{
    const raw = localStorage.getItem('ui:theme');
    const saved = raw ? JSON.parse(raw) : { mode:'dark', accent:'#22d3ee' };
    const mode = (saved.mode==='light') ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', mode);
    document.documentElement.style.setProperty('--accent', saved.accent || '#22d3ee');
    const meta = document.querySelector('meta[name="theme-color"]');
    if (meta) meta.setAttribute('content', mode==='light' ? '#f2efe7' : '#0f172a');

    const swapLogo = ()=>{
      const logo = document.querySelector('.brand img');
      if (logo) logo.src = (mode==='light') ? 'fambam2.png' : 'fambam.png';
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', swapLogo, {once:true});
    } else { swapLogo(); }

    window.addEventListener('storage', (e)=>{
      if (e.key!=='ui:theme') return;
      try{
        const t = JSON.parse(e.newValue||'{}');
        const m = (t.mode==='light') ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', m);
        document.documentElement.style.setProperty('--accent', t.accent || '#22d3ee');
        if (meta) meta.setAttribute('content', m==='light' ? '#f2efe7' : '#0f172a');
        const logo = document.querySelector('.brand img');
        if (logo) logo.src = (m==='light') ? 'fambam2.png' : 'fambam.png';
      }catch(_){}
    });
  }catch(_){}
})();
</script>

<style>
/* -------- Chores page (scoped) -------- */
.page-chores .app{
  max-width:1100px; margin:0 auto; padding:20px;
  display:grid; gap:18px; grid-template-rows:auto auto 1fr auto;
}

/* keep header and its dropdown above content */
.page-chores header.panel { position:relative; z-index:1000; }
.page-chores .menu-wrap { position:relative; z-index:1001; }
.page-chores .menu-dd    { z-index:1002; }

/* Week panel line */
.page-chores #weekPanel .row{ display:flex; align-items:center; gap:10px; }

/* Board grid */
.page-chores .board{
  display:grid; grid-template-columns:repeat(1,minmax(0,1fr)); gap:14px;
}
@media(min-width:900px){
  .page-chores .board{ grid-template-columns:repeat(3,minmax(0,1fr)); }
}

/* Chore card */
.page-chores .card{
  display:grid; gap:10px;
  background:var(--panel); border:1px solid var(--panelBorder);
  border-radius:16px; padding:14px; min-height:190px;
}
.page-chores .card .head{ display:flex; align-items:center; justify-content:space-between; }
.page-chores .chore-name{ font-weight:800; }
.page-chores .badge{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px;
  background:var(--chipBg); border:1px solid var(--chipBorder);
}
.page-chores .person{ display:flex; align-items:center; gap:10px; }
.page-chores .face{
  width:52px; height:52px; border-radius:50%; overflow:hidden;
  display:grid; place-items:center; background:var(--chipBg);
  border:2px solid var(--chipBorder); font-size:24px; font-weight:800;
}
.page-chores .face img{ width:100%; height:100%; object-fit:cover; }
.page-chores .selector{ display:flex; gap:8px; align-items:center; }
.page-chores .select{ max-width:100%; }
.page-chores .swap{ outline:2px solid transparent; }
.page-chores .swap[aria-selected="true"]{ outline:2px solid var(--accent); }
.page-chores .help{ opacity:.8; }

/* Done dots */
.page-chores .dots{ display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; }
.page-chores .dot{
  width:36px; height:36px; border-radius:999px; cursor:pointer; user-select:none;
  display:grid; place-items:center; font-weight:800; font-size:.85rem;
  background:var(--chipBg); border:1px solid var(--chipBorder); color:#cbd5e1;
}
html[data-theme="light"] .page-chores .dot{ color:#334155; }
.page-chores .dot.done{
  background:#0f766e; border-color:#0d9488; color:#e6fffa;
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.18);
}
.page-chores .dot:active{ transform:translateY(1px); }

/* Modal */
.page-chores .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55);
  display:none; align-items:center; justify-content:center; z-index:10000; padding:20px; }
.page-chores .modal{
  width:min(900px,100%); background:var(--panel); border:1px solid var(--panelBorder);
  border-radius:16px; box-shadow:var(--shadow);
}
.page-chores .modal header{
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 16px; border-bottom:1px solid var(--panelBorder);
}
.page-chores .modal .body{ padding:14px 16px; display:grid; gap:16px; }
.page-chores .modal .footer{
  padding:14px 16px; border-top:1px solid var(--panelBorder);
  display:flex; justify-content:flex-end; gap:10px;
}
.page-chores .list{ display:grid; gap:10px; }
.page-chores .item{
  display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
  background:var(--card); border:1px solid var(--panelBorder); border-radius:12px; padding:10px;
}
.page-chores .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.page-chores .chklist{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px; }
@media(min-width:720px){ .page-chores .chklist{ grid-template-columns:repeat(3,minmax(0,1fr)); } }

.page-chores .footer{ text-align:center; opacity:.7; font-size:.85rem; }
.page-chores .version{ opacity:.6; font-size:.8rem; margin-top:6px; }

/* Inputs that aren't covered by shared .btn styles */
.page-chores input[type="text"]{
  background:var(--card); border:1px solid var(--panelBorder);
  border-radius:12px; padding:10px 12px; color:var(--text); font:inherit;
}

/* a11y helper */
.page-chores .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>
</head>

<body class="page-chores">
  <div class="app">
    <!-- Shared header -->
    <header class="panel header">
      <a href="./index.html" class="brand" title="Home">
        <img src="fambam.png" alt="Fambam">
      </a>
      <div class="title">
        <div class="big" style="font-size:1.6rem">Chores</div>
        <div class="small">Weekly rotation (Mon–Sun). Tap a card to swap or use the dropdown to reassign.</div>
      </div>
      <div class="menu-wrap">
        <button id="btnMenu" class="hamburger" aria-haspopup="true" aria-expanded="false">☰</button>
        <div id="menuDD" class="menu-dd" role="menu" aria-hidden="true">
          <button class="mi" data-action="shuffle">Shuffle</button>
          <button class="mi" data-action="manage">Manage</button>
        </div>
      </div>
    </header>

    <section id="weekPanel" class="panel">
      <div class="row">
        <div class="help">Week of <b id="weekLabel"></b></div>
      </div>
    </section>

    <section id="board" class="board"></section>

    <div class="footer">
      Works offline. Data stays on this device (local only).
      <div class="version">Chores v1.3.1 — theme-ready</div>
    </div>
  </div>

  <!-- Manage Modal -->
  <div id="manageModal" class="modal-backdrop" aria-hidden="true" role="dialog" aria-labelledby="manageTitle">
    <div class="modal">
      <header>
        <div id="manageTitle" style="font-weight:800">Manage Chores</div>
        <button id="manageClose" class="btn">✖</button>
      </header>
      <div class="body">
        <div class="help">Edit the chore list and which kids participate in the rotation.</div>

        <div>
          <div class="badge">Chore List</div>
          <div id="choreList" class="list"></div>
          <div class="row">
            <input id="newChore" type="text" placeholder="Add chore (e.g., Trash)" />
            <button id="addChore" class="btn-primary">Add</button>
          </div>
        </div>

        <div>
          <div class="badge">Eligible Kids</div>
          <div id="kidChecks" class="chklist"></div>
          <div class="help">Only checked kids will be included in the weekly rotation.</div>
        </div>
      </div>
      <div class="footer">
        <button id="manageSave" class="btn-primary">Save</button>
      </div>
    </div>
  </div>

<!-- Family Store -->
<script src="family.js?v=3.3.6"></script>
<script>
/* ===== Keep your existing logic (unchanged except for menu wiring names) ===== */
/* ... all your JS from the previous file, starting at the Family shim, storage keys,
   helpers, rotation logic, renderBoard, manage modal, etc. Paste it here verbatim. ... */

/* --- Simple shared-style menu (uses .menu-wrap/.menu-dd/.mi) --- */
(function menu(){
  const btn = document.getElementById('btnMenu');
  const dd  = document.getElementById('menuDD');
  const open = ()=>{ dd.classList.add('open'); btn.setAttribute('aria-expanded','true'); dd.setAttribute('aria-hidden','false'); };
  const close= ()=>{ dd.classList.remove('open'); btn.setAttribute('aria-expanded','false'); dd.setAttribute('aria-hidden','true'); };

  btn.addEventListener('click', (e)=>{ e.stopPropagation(); dd.classList.contains('open')?close():open(); });
  document.addEventListener('click', (e)=>{ if (!dd.contains(e.target) && e.target!==btn) close(); });

  dd.addEventListener('click', (e)=>{
    const a = e.target.closest('.mi'); if(!a) return;
    close();
    const act = a.dataset.action;
    if (act==='shuffle'){ rotateForWeek(thisMondayISO()); renderBoard(); }
    else if (act==='manage'){ openManage(); }
  });
})();
</script>
</body>
</html>