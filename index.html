<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fambam</title>

<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.webmanifest">
<link rel="stylesheet" href="wallpaper.css">
<script src="wallpaper.js" defer></script>

<script>
/* THEME BOOT + logo swap (copy this into other pages)
   Applies saved theme immediately and swaps header logo for light mode. */
(function themeBoot(){
  try{
    const raw = localStorage.getItem('ui:theme');
    const saved = raw ? JSON.parse(raw) : { mode:'dark', accent:'#22d3ee' };
    const mode = (saved.mode==='light') ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', mode);
    document.documentElement.style.setProperty('--accent', saved.accent || '#22d3ee');
    const meta = document.querySelector('meta[name="theme-color"]');
    const headerColor = (mode==='light') ? '#f2efe7' : '#0f172a';
    if (meta) meta.setAttribute('content', headerColor);
    const swapLogo = ()=>{
      const logo = document.getElementById('logoImg');
      if (logo) logo.src = (document.documentElement.getAttribute('data-theme')==='light') ? 'fambam2.png' : 'fambam.png';
    };
    requestAnimationFrame(swapLogo);
    window.addEventListener('storage', (e)=>{
      if (e.key==='ui:theme'){
        try{
          const t = JSON.parse(e.newValue||'{}');
          const m = (t.mode==='light') ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', m);
          document.documentElement.style.setProperty('--accent', t.accent || '#22d3ee');
          if (meta) meta.setAttribute('content', m==='light' ? '#f2efe7' : '#0f172a');
          swapLogo();
        }catch(_){}
      }
    });
  }catch(_){}
})();
</script>

<style>
/* --- layout sanity --- */
*, *::before, *::after { box-sizing: border-box; }

/* Base tokens (overridden by [data-theme]) */
:root{
  --panel:#111827; --card:#1f2937; --muted:#94a3b8; --text:#e5e7eb; --accent:#22d3ee;
  --bg:#0f172a; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
  --wallpaper:url(''); --wallpaper-shift:40%;
  --slotH: 220px;

  --panelBorder:#0b1224;
  --tileBorder: rgba(31,41,55,.95);
  --glassHeader: rgba(17,24,39,.5);
  --chipBg:#0b1224;
  --chipBorder:#334155;
  --previewBg:#081228;
  --previewBorder:#27324a;
}

/* LIGHT THEME OVERRIDES (soft ivory palette) */
html[data-theme="light"]{
  --panel:#f2efe7; --card:#ffffff; --muted:#556070; --text:#0f1623; --bg:#f0ece4;
  --shadow:0 10px 28px rgba(0,0,0,.08);
  --panelBorder:#e6e2da; --tileBorder:#ebe7df; --glassHeader: rgba(255,255,255,.72);
  --chipBg:#f6f3ec; --chipBorder:#e3ded4; --previewBg:#fffdf7; --previewBorder:#ebe6db;
}
html,body{height:100%}
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  color:var(--text); background:#404c69; overflow-x:hidden;
}
/* Wallpaper */
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background-image: var(--wallpaper);
  background-size: cover; background-repeat:no-repeat;
  background-position: center var(--wallpaper-shift);
  transform: translateZ(0);
}
body::after{
  content:""; position:fixed; inset:0; z-index:-1;
  background: rgba(64,76,105,.9);
  pointer-events:none;
}

/* App */
.app{
  min-height: 100svh;
  display:flex; flex-direction:column; gap:18px;
  padding:20px; max-width:1100px; margin:0 auto;
}
/* Header */
header{
  position:relative; z-index: 9000; isolation:isolate;
  display:flex;justify-content:space-between;align-items:center;
  background:var(--glassHeader); border:1px solid var(--panelBorder);
  border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;
  backdrop-filter: blur(8px);
}
.title{display:flex;align-items:center;gap:10px}
.title img{height:38px;display:block}
.menu-wrap{position:relative; z-index: 9001; overflow:visible}
.hamburger{font:inherit;cursor:pointer;background:var(--chipBg);color:var(--text);border:1px solid var(--chipBorder);border-radius:12px;padding:10px 12px}
.menu-dropdown{
  position:absolute;right:0;top:110%;min-width:260px;z-index:9002 !important;
  background:var(--panel);border:1px solid var(--panelBorder);border-radius:12px;
  box-shadow:var(--shadow);padding:6px;display:none
}
.menu-dropdown.open{display:block}
.menu-item{width:100%;text-align:left;padding:10px 12px;border:none;background:transparent;color:var(--text);border-radius:10px;cursor:pointer}
.menu-item:hover{background:var(--chipBg)}

/* Grid */
#slots{
  margin-top:12px; display:grid; gap:16px;
  grid-template-columns:repeat(4, minmax(0,1fr));
  grid-auto-rows: var(--slotH);
}
@media(max-width:860px){ #slots{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
.slot{ height: var(--slotH); border-radius:16px; position:relative; }
.slot.editing{ outline:2px dashed var(--chipBorder); background:rgba(2,6,23,.06); }
html[data-theme="light"] .slot.editing{ background:rgba(15,22,35,.04); }
.slot.editing .add-btn{
  position:absolute; inset:auto 10px 10px auto;
  background:var(--chipBg); border:1px dashed var(--chipBorder); color:var(--text);
  border-radius:999px; width:44px; height:44px; display:grid; place-items:center; cursor:pointer;
}

/* Tile */
.tile{
  position:relative;
  display:flex;flex-direction:column;gap:10px;align-items:flex-start;
  background:var(--card);border:1px solid var(--tileBorder);
  border-radius:16px;padding:16px;text-decoration:none;color:var(--text);
  box-shadow:var(--shadow);backdrop-filter: blur(4px);
  height:100%; overflow:hidden;
}
.tile .emoji{font-size:36px;filter:drop-shadow(0 6px 10px rgba(0,0,0,.12))}
.tile .label{font-weight:800}
.tile .hint{opacity:.8}

/* Prevent iOS long-press link preview/callout on tiles */
.tile { -webkit-touch-callout: none; }

/* Drag ghost is sized explicitly via JS (width/height inline) */
.drag-ghost{
  position:fixed;
  pointer-events:none;
  z-index:9999;
  transform: translate(-50%,-50%) scale(.98);
  filter: drop-shadow(0 10px 22px rgba(0,0,0,.35));
  opacity:.96;
  overflow:hidden;            /* hide any overflow content */
  will-change: transform,left,top;
}
/* blocks native scroll gestures that compete with long-press */
#slots, #slots .tile { touch-action: none; }

/* Stop iOS text selection / interactions while dragging */
.dragging, .dragging * {
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
}
.dragging { touch-action: none; cursor: grabbing; }

/* Drag ghost: keep exact size of the picked card */
.drag-ghost{
  position: fixed;
  left: 0; top: 0;
  transform: translate(-50%,-50%) scale(.98);
  z-index: 9999;
  pointer-events: none;
  filter: drop-shadow(0 10px 22px rgba(0,0,0,.35));
  opacity: .96;
  overflow: hidden;           /* never grow by content */
  box-sizing: border-box;
}

/* while dragging, lock page scroll */
html.drag-lock, body.drag-lock {
  overflow: hidden !important;
  overscroll-behavior: contain;
}

/* make sure the shield doesn't allow touch scrolling */
.drag-shield {
  position: fixed;
  inset: 0;
  z-index: 9998;
  background: transparent;
  pointer-events: auto;
  touch-action: none;
  cursor: grabbing;
}
   
/* Shared preview surfaces */
.bf-box,.dp-box,.ch-box,.pt-box,.fam-box{
  margin-top:6px; width:100%;
  background:var(--previewBg); border:1px solid var(--previewBorder);
  border-radius:16px; padding:12px;
  max-height: calc(var(--slotH) - 72px);
  overflow:hidden;
}

/* Breakfast preview */
.bf-date{font-size:.9rem;font-weight:800}
.bf-empty{opacity:.8;font-size:.95rem;margin-top:10px}
.bf-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px 12px; margin-top:10px; }
.bf-item{ display:flex; align-items:center; gap:10px; min-height:40px; }
.bf-face{ width:34px; height:34px; border-radius:50%; overflow:hidden; display:grid; place-items:center; flex:0 0 auto; background:#334155; color:#e5e7eb; font-size:.95rem; font-weight:800; }
html[data-theme="light"] .bf-face{ background:#e3e0d8; color:#1b2432; }
.bf-face img{width:100%;height:100%;object-fit:cover}
.bf-emoji{font-size:1.4rem; line-height:1}

/* Dinner preview */
.dp-title{font-size:.95rem;font-weight:800}
.dp-empty{opacity:.8;font-size:.95rem;margin-top:10px}
.dp-rows{display:grid; gap:10px; margin-top:10px}
.dp-row{display:flex; align-items:center; justify-content:space-between}
.dp-row .who{font-weight:800}
.dp-icons{display:flex; align-items:center; gap:10px; font-size:1.4rem; line-height:1}

/* Chores preview */
.ch-title{font-size:.95rem;font-weight:800}
.ch-empty{opacity:.8;font-size:.95rem;margin-top:10px}
.ch-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px 12px; margin-top:10px; }
.ch-item{display:flex; align-items:center; gap:10px; min-height:40px}
.ch-task{font-size:1.2rem; line-height:1;}

/* Points preview (2×2 leaderboard) */
.pt-title{font-size:.95rem;font-weight:800}
.pt-empty{opacity:.8;font-size:.95rem;margin-top:10px}
.pt-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px 12px; margin-top:10px; }
.pt-item{display:flex; align-items:center; gap:10px; min-height:40px}
.pt-score{font-weight:800;}

/* Family preview */
.fam-title{font-size:.95rem;font-weight:800}
.fam-sub{opacity:.9;font-size:.95rem;margin-top:4px;min-height:1.2em}
.fam-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px 12px; margin-top:10px; }
.fam-item{display:flex; align-items:center; gap:10px; min-height:40px}

/* Edit affordances */
.tile .minus{
  position:absolute; right:8px; bottom:8px; width:36px; height:36px;
  display:none; place-items:center; font-weight:800;
  background:#3f1620; border:1px solid #7f1d1d; color:#fecaca; border-radius:999px;
}
.editing .tile .minus{ display:grid; cursor:pointer; }
.tile.selecting{ outline:2px solid var(--accent); }

/* Photos tile */
.tile.photo-only{ padding:0; border:none; background:transparent; box-shadow:none; }
.photo-prev{ position:absolute; inset:0; border-radius:16px; overflow:hidden; z-index:0; opacity:.22; }
.photo-prev img{ width:100%; height:100%; object-fit:cover; display:block; }
.tile.photos-card{ background: transparent; border: none; padding: 0; }
.tile.photos-card .photo-prev{ opacity: 1; }
.tile.photos-card .emoji, .tile.photos-card .label, .tile.photos-card .hint{ display: none; }
.tile.photos-card .minus{ display:none; }
.editing .tile.photos-card .minus{ display:grid; background: rgba(0,0,0,.4); border-color:#000; }
.tile.photos-card::before{ content:""; position:absolute; inset:0; border-radius:16px; box-shadow: var(--shadow); pointer-events:none; }

/* Subtle "open" arrow on Photos card */
.photos-arrow{
  position:absolute; right:10px; bottom:10px;
  width:38px; height:38px; border-radius:50%; border:2px solid #fff;
  background:rgba(0,0,0,.2); color:#fff; display:grid; place-items:center;
  font-size:18px; line-height:1; opacity:.2; transition:opacity .2s, transform .2s; pointer-events:none;
}
.tile.photos-card:hover .photos-arrow{ opacity:.6; transform:translateY(-1px); }

/* Modal + form + edit bar */
.sr-only{position:absolute !important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:10000;padding:20px}
.modal{width:min(900px,100%);background:var(--panel);border:1px solid var(--panelBorder);border-radius:16px;box-shadow:var(--shadow)}
.modal header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--panelBorder)}
.modal .body{padding:14px 16px;display:grid;gap:18px;max-height:70vh;overflow:auto}
.modal .footer{padding:14px 16px;border-top:1px solid var(--panelBorder);display:flex;justify-content:flex-end;gap:10px}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{padding:8px 12px;border-radius:10px;background:var(--chipBg);border:1px solid var(--chipBorder);cursor:pointer;color:var(--text)}
.tab[aria-selected="true"]{outline:2px solid var(--accent)}
.list{display:grid; gap:12px;}
.item{display:flex;align-items:center;gap:10px;background:var(--card);border:1px solid var(--panelBorder);border-radius:12px;padding:12px}
.item .grow{flex:1}
.face{width:48px;height:48px;border-radius:50%;background:var(--chipBg);display:grid;place-items:center;font-size:22px;border:2px solid var(--chipBorder);overflow:hidden}
.face img{width:100%;height:100%;object-fit:cover}
.row{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin:6px 0;}
.btn{font:inherit;color:var(--text);background:var(--chipBg);border:1px solid var(--chipBorder);border-radius:12px;padding:10px 12px;cursor:pointer}
.btn-primary{background:linear-gradient(180deg,var(--accent),color-mix(in oklab, var(--accent) 70%, #0891b2 30%));color:#001018;border:none;font-weight:800}
.btn-lg{padding:12px 16px;border-radius:14px;font-weight:800}
.btn-warn{background:#3f1620;border:1px solid #7f1d1d;color:#fecaca}
.btn[disabled]{opacity:.5;filter:grayscale(1);pointer-events:none}
.toggle{display:inline-flex;align-items:center;gap:8px}
#editBar{display:none; align-items:center; justify-content:space-between;margin-top:6px; padding:10px 12px; border-radius:12px;background:rgba(17,24,39,.65); border:1px solid var(--panelBorder);}
html[data-theme="light"] #editBar{ background:rgba(255,255,255,.7); }
#editBar.show{display:flex}

/* --- NEW: drag & drop affordances --- */
.slot.drag-target{ outline:2px solid var(--accent); outline-offset:2px; }
.drag-ghost{
  position:fixed; pointer-events:none; z-index:9999;
  transform: translate(-50%,-50%) scale(.98);
  filter: drop-shadow(0 10px 22px rgba(0,0,0,.35));
  width: clamp(180px, 40vw, 320px); /* responsive ghost size */
  opacity:.95;
}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <img id="logoImg" src="fambam.png" alt="Fambam">
      </div>
      <div class="menu-wrap">
        <button id="btnMenu" class="hamburger" aria-haspopup="true" aria-expanded="false" aria-controls="menuDropdown" title="Menu">☰</button>
        <div id="menuDropdown" class="menu-dropdown" role="menu" aria-hidden="true">
          <button class="menu-item" data-action="pages" role="menuitem">All Pages</button>
          <button class="menu-item" data-action="edithome" role="menuitem">Edit Home</button>
          <button class="menu-item" data-action="admin" role="menuitem">Admin Settings</button>
          <button class="menu-item" data-action="about" role="menuitem">About</button>
        </div>
      </div>
    </header>

    <!-- Edit bar -->
    <div id="editBar">
      <div>Tap a card, then tap a slot to move it. Use “+” to add. Tap “−” on a card to remove.</div>
      <div style="display:flex;gap:10px">
        <button id="btnAddAnywhere" class="btn">Add/Remove Card</button>
        <button id="btnDoneEdit" class="btn-primary">Done</button>
      </div>
    </div>

    <!-- Fixed grid of 16 slots -->
    <main id="slots" aria-label="Home grid"></main>
  </div>

  <!-- Hidden pickers -->
  <input type="file" id="file-picker" accept="image/*" class="sr-only"/>
  <input type="file" id="wallpaper-picker" accept="image/*" class="sr-only"/>

  <!-- Admin Modal -->
  <div class="modal-backdrop" id="adminModal" aria-hidden="true" role="dialog" aria-labelledby="adminTitle">
    <div class="modal">
      <header>
        <div id="adminTitle" style="font-weight:800">Admin Settings</div>
        <button id="adminClose" class="btn">✖</button>
      </header>
      <div class="body">
        <div class="tabs">
          <button class="tab" data-tab="parents" aria-selected="true">Parents</button>
          <button class="tab" data-tab="kids">Kids</button>
          <button class="tab" data-tab="global">Global Settings</button>
        </div>

        <!-- Parents -->
        <section class="tab-panel" data-panel="parents">
          <div class="list" id="parentsList"></div>
          <div class="row">
            <input id="newParentName" class="btn" placeholder="Add parent name" />
            <button id="addParent" class="btn-primary btn-lg">Add Parent</button>
          </div>
          <div class="row">
            <input id="pinInput" class="btn" placeholder="Set Admin PIN (optional)" inputmode="numeric" />
            <button id="savePin" class="btn-primary btn-lg">Save PIN</button>
          </div>
        </section>

        <!-- Kids -->
        <section class="tab-panel" data-panel="kids" style="display:none">
          <div class="list" id="kidsList"></div>
          <div class="row">
            <input id="newKidName" class="btn" placeholder="Add kid name" />
            <button id="addKid" class="btn-primary btn-lg">Add Kid</button>
          </div>
        </section>

        <!-- Global Settings -->
        <section class="tab-panel" data-panel="global" style="display:none">
          <div class="item" style="align-items:flex-start">
            <div class="grow">
              <div style="font-weight:800; margin-bottom:6px">Theme</div>
              <div class="row">
                <label class="toggle"><input type="radio" name="themeMode" value="dark" checked> Dark</label>
                <label class="toggle"><input type="radio" name="themeMode" value="light"> Light</label>
              </div>
              <
