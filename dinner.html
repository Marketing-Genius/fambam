<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fambam ¬∑ Dinner Planner</title>

<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.webmanifest">

<link rel="stylesheet" href="wallpaper.css">
<script src="wallpaper.js" defer></script>

<script>
/* THEME BOOT (dark/light + accent + auto logo swap) */
(function () {
  var DARK_SRC='fambam.png', LIGHT_SRC='fambam2.png', theme={mode:'dark',accent:'#22d3ee'};
  function apply(t){
    var m=(t&&t.mode==='light')?'light':'dark', a=(t&&t.accent)||'#22d3ee';
    theme={mode:m,accent:a};
    document.documentElement.setAttribute('data-theme',m);
    document.documentElement.style.setProperty('--accent',a);
    var meta=document.querySelector('meta[name="theme-color"]');
    if(meta) meta.setAttribute('content', m==='light'?'#f2efe7':'#0f172a');
  }
  function swapLogo(){
    var img=document.querySelector('.brand img[alt="Fambam"]'); if(!img) return;
    var base=(img.getAttribute('src')||'').replace(/[^/]*$/,'');
    img.src=base + (theme.mode==='light'?LIGHT_SRC:DARK_SRC);
  }
  try{apply(JSON.parse(localStorage.getItem('ui:theme')||'{}'));}catch{apply();}
  document.readyState==='loading'?document.addEventListener('DOMContentLoaded',swapLogo,{once:true}):swapLogo();
  window.addEventListener('storage',e=>{ if(e.key!=='ui:theme')return; try{apply(JSON.parse(e.newValue||'{}'));}catch{} swapLogo(); });
})();
</script>

<style>
:root{
  --panel:#111827; --card:#1f2937; --muted:#94a3b8; --text:#e5e7eb; --accent:#22d3ee;
  --bg:#0f172a; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px
}
/* Light theme overrides */
html[data-theme="light"]{
  --panel:#f2efe7; --card:#fffdf7; --muted:#556070; --text:#0f1623;
  --shadow:0 10px 28px rgba(0,0,0,.08);
}

html,body{height:100%}
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--text); background:linear-gradient(180deg,#0b1026 0%,#0f172a 100%);
  -webkit-tap-highlight-color:transparent; touch-action:manipulation;
}
.app{max-width:1100px;margin:0 auto;padding:20px;display:grid;gap:18px;grid-template-rows:auto auto 1fr auto}
.panel{background:var(--panel);border:1px solid #111827;box-shadow:var(--shadow);border-radius:var(--radius);padding:14px}
html[data-theme="light"] .panel{ border-color:#e6e2da; }

/* Header */
header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.h-left{display:flex;align-items:center;gap:14px;min-width:0}
.brand{display:flex;align-items:center;gap:10px}
.brand img{height:38px;display:block;cursor:pointer}
.title{font-weight:800;letter-spacing:.2px}
.title .small{font-weight:600;font-size:.85rem;color:var(--muted)}
.h-right{display:flex;align-items:center;gap:10px}

/* Menu */
.menu-wrap{position:relative}
.hamburger{font:inherit;cursor:pointer;background:#0b1224;border:1px solid #334155;border-radius:12px;color:#e5e7eb;padding:10px 12px}
html[data-theme="light"] .hamburger{ background:#fffdf7; border-color:#dcd6c8; color:#0f1623; }
.menu-dropdown{
  position:absolute; right:0; top:110%; min-width:220px; z-index:20;
  background:#111827; border:1px solid #1f2937; border-radius:12px;
  box-shadow:var(--shadow); padding:6px; display:none;
}
html[data-theme="light"] .menu-dropdown{ background:#fffef9; border-color:#e6e2da; }
.menu-dropdown.open{display:block}
.menu-item{display:block;width:100%;text-align:left;padding:10px 12px;border:none;background:transparent;color:var(--text);border-radius:10px;cursor:pointer}
.menu-item:hover{background:#0b1224}
html[data-theme="light"] .menu-item:hover{ background:#f3efe5; }

/* Day toolbar */
.daybar{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.daynav{display:flex;align-items:center;gap:8px}
.daybtn{background:#0b1224;border:1px solid #334155;border-radius:12px;padding:8px 10px;color:var(--text);cursor:pointer}
html[data-theme="light"] .daybtn{ background:#fffdf7; border-color:#dcd6c8; color:#0f1623; }
.dayname{font-weight:800}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#0b1224;border:1px solid #334155;color:#cbd5e1}
html[data-theme="light"] .badge{ background:#fffdf7; border-color:#dcd6c8; color:#334155; }

/* Single-day card */
.card{display:grid;gap:12px;background:var(--panel);border:1px solid #1f2937;border-radius:16px;padding:14px}
html[data-theme="light"] .card{ border-color:#e1ddd2; }
.card .head{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.card .head .right{display:flex;gap:8px;align-items:center}

/* Header image */
.hero{position:relative; border-radius:14px; overflow:hidden; background:#0b1224; border:1px solid #334155; transition:height .2s}
.hero img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
.hero .overlay{position:absolute; right:8px; bottom:8px; display:flex; gap:8px}
.hero.empty{height:56px; background:transparent; border:1px dashed #334155}
.hero:not(.empty){height:200px}
html[data-theme="light"] .hero.empty{ border-color:#dcd6c8; }

/* Inputs */
select, input[type="text"], textarea{background:var(--card);border:1px solid #374151;border-radius:12px;padding:10px 12px;min-width:140px;color:var(--text);font:inherit}
html[data-theme="light"] select, html[data-theme="light"] input[type="text"], html[data-theme="light"] textarea{ border-color:#dcd6c8; }
textarea{min-height:88px;resize:vertical}
button{cursor:pointer}
.btn{background:#0b1224;border:1px solid #334155;border-radius:12px;padding:10px 12px;color:#e5e7eb;font:inherit}
html[data-theme="light"] .btn{ background:#fffdf7; border-color:#dcd6c8; color:#0f1623; }
.btn-primary{background:linear-gradient(180deg,#22d3ee,#06b6d4);color:#001018;border:none;font-weight:800}
.btn-warn{background:#3f1620;border:1px solid #7f1d1d;color:#fecaca}
.smallmuted{color:#94a3b8;font-size:.9rem}

/* Modals etc (unchanged) */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:10000;padding:20px}
.modal{width:min(900px,100%);max-height:90vh;display:flex;flex-direction:column;background:var(--panel);border:1px solid #1f2937;border-radius:16px;box-shadow:var(--shadow)}
.modal header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #1f2937;position:sticky;top:0;background:inherit;z-index:1}
.modal .body{padding:14px 16px;display:grid;gap:16px;overflow:auto;max-height:70vh}
@supports (-webkit-touch-callout: none) { .modal .body{ -webkit-overflow-scrolling: touch; } }
.modal .footer{padding:14px 16px;border-top:1px solid #1f2937;display:flex;justify-content:flex-end;gap:10px;position:sticky;bottom:0;background:inherit}
.list{display:grid;gap:10px}
.item{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;background:#1f2937;border:1px solid #111827;border-radius:12px;padding:10px}
.btn-badge{position:relative}
.btn-badge[data-hasnotes="true"]::after{content:"";position:absolute;right:8px;top:8px;width:8px;height:8px;border-radius:50%;background:#22d3ee;box-shadow:0 0 0 2px rgba(11,18,36,.8);}
.noteRow{display:flex;align-items:center;justify-content:space-between;background:#1f2937;border:1px solid #111827;border-radius:12px;padding:10px}
input[type="file"].sr-only{ display:none !important; }

.hint{opacity:.8;font-size:.9rem;text-align:center}
.version{opacity:.6;font-size:.8rem;margin-top:6px}
</style>
</head>
<body>
  <div class="app">
    <header class="panel">
      <div class="h-left">
        <a href="./index.html" class="brand" title="Home">
          <img src="fambam.png" alt="Fambam">
        </a>
        <div class="title">
          <div style="font-size:1.6rem">Dinner Planner</div>
          <div class="small">Plan dinners for the week. Templates, groceries & sharing included.</div>
        </div>
      </div>
      <div class="h-right">
        <div class="menu-wrap">
          <button id="btnHamburger" class="hamburger" aria-haspopup="true" aria-expanded="false" aria-controls="menuDropdown">‚ò∞</button>
          <div id="menuDropdown" class="menu-dropdown" role="menu" aria-hidden="true">
            <button class="menu-item" data-action="reset">Reset Week</button>
            <button class="menu-item" data-action="templates">Templates</button>
            <button class="menu-item" data-action="groceries">Groceries</button>
            <button class="menu-item" data-action="shareGro">Share Groceries</button>
            <button class="menu-item" data-action="sharePlan">Share Plan</button>
            <button class="menu-item" data-action="manage">Manage</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Day toolbar -->
    <section class="panel daybar" id="weekPanel">
      <div class="daynav">
        <button id="prevDay" class="daybtn" title="Previous day">‚óÄÔ∏é</button>
        <div class="dayname"><span id="dayLabel">Mon</span> ¬∑ <span id="dateLabel">Sep 9</span></div>
        <button id="nextDay" class="daybtn" title="Next day">‚ñ∂Ô∏é</button>
      </div>
      <div class="badge">Week of <b id="weekLabel"></b></div>
    </section>

    <!-- Single-day view -->
    <section id="dayCard" class="card">
      <div id="hero" class="hero empty">
        <img id="heroImg" alt="">
        <div class="overlay">
          <button id="btnAddHero" class="btn">Header photo</button>
          <button id="btnRemoveHero" class="btn-warn">Remove</button>
        </div>
      </div>

      <div class="head">
        <div style="font-weight:800">Selections</div>
        <div class="right">
          <select id="rateSel" title="How did dinner go?">
            <option value="">‚Äî rating ‚Äî</option>
            <option value="1">üëç</option>
            <option value="0">üòê</option>
            <option value="-1">üëé</option>
          </select>
          <button id="btnDayNotes" class="btn btn-badge">Notes</button>
          <button id="btnRecipeSearch" class="btn">Search recipes</button>
        </div>
      </div>

      <div class="row">
        <div class="label">Kids</div>
        <select id="kidsMain"></select>
        <select id="kidsSide"></select>
      </div>
      <div class="row">
        <div class="label">Parents</div>
        <select id="parentsMain"></select>
        <select id="parentsSide"></select>
      </div>
      <div class="row">
        <div class="label">Dessert</div>
        <div class="actions">
          <select id="dessertSel" style="display:none"></select>
          <button id="btnDessert" class="btn">Add dessert</button>
        </div>
      </div>
    </section>

    <div class="hint">
      Works offline. Data stays on this device (local only).
      <div class="version">Dinner Planner v2.0.1 (day view + header image + recipe search)</div>
    </div>
  </div>

  <input id="heroPicker" type="file" accept="image/*,.heic,.heif" class="sr-only"/>

  <!-- Manage / Templates / Groceries / Notes modals (unchanged from your file) -->
  <!-- ‚Ä¶ to keep this reply concise, those modal sections are identical to your last version ‚Ä¶ -->

  <script>
  /* Share helper unchanged */
  async function shareText(content){
    try{ if(navigator.share){ await navigator.share({text:content}); return; } }catch{}
    const encoded=encodeURIComponent(content);
    const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
    const href=isIOS?`sms:&body=${encoded}`:`sms:?body=${encoded}`;
    try{ location.href=href; return; }catch{}
    try{ await navigator.clipboard.writeText(content); alert('Copied to clipboard.'); }
    catch{ alert('Share unavailable. Copy/paste this:\n\n'+content); }
  }
  </script>

  <script>
/* ---------- Storage / helpers (same keys) ---------- */
const LS={foods:'dp:foods:list',desserts:'dp:desserts:list',week:(m)=>`dp:plan:${m}`,templates:'dp:tpls',pantry:'dp:pantry', notes:'dp:food:notes'};
const $=(s,e=document)=>e.querySelector(s), $$=(s,e=document)=>[...e.querySelectorAll(s)];
const load=(k,f)=>{try{const v=JSON.parse(localStorage.getItem(k));return v??f;}catch{return f}};
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const uid=()=>Math.random().toString(36).slice(2,10);

function localISO(d){const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${day}`;}
function startOfWeekMondayLocal(d=new Date()){const monday=new Date(d);monday.setHours(0,0,0,0);const offset=((monday.getDay()+6)%7);monday.setDate(monday.getDate()-offset);return monday;}
function thisMondayISO(){ return localISO(startOfWeekMondayLocal(new Date())); }
function weekLabelText(mISO){const [Y,M,D]=mISO.split('-').map(n=>parseInt(n,10));const m=new Date(Y,M-1,D,0,0,0,0);const e=new Date(m);e.setDate(e.getDate()+6);const f=d=>d.toLocaleDateString(undefined,{month:'short',day:'numeric'});return `${f(m)} ‚Äì ${f(e)}`;}
function todayIdxInWeek(mISO){ const [Y,M,D]=mISO.split('-').map(Number); const m=new Date(Y,M-1,D); const t=new Date(); t.setHours(0,0,0,0); const diff=Math.floor((t-m)/86400000); return Math.max(0, Math.min(6, diff)); }
const DAYS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
function emptyDay(){return {kids:{main:"",side:""},parents:{main:"",side:""},dessert:"",rating:null,hero:null}}
function loadWeekPlan(mISO){ let plan=load(LS.week(mISO),null); if(!plan){ plan={days:{}};DAYS.forEach(d=>plan.days[d]=emptyDay()); save(LS.week(mISO),plan); } return plan; }
function saveWeekPlan(mISO,plan){save(LS.week(mISO),plan)}
function getNotes(){ return load(LS.notes, {}); }
function setNotes(map){ save(LS.notes, map); }
function seedFoodsIfNeeded(){ let foods=load(LS.foods,null); if(!Array.isArray(foods)||foods.length<10){ foods=["üçï Pizza","üåÆ Tacos","üçù Spaghetti","üçó Chicken Nuggets","ü•™ Sandwiches","üå≠ Hot Dogs","üçî Burgers","ü•ó Caesar Salad","üçõ Curry & Rice","ü•ü Potstickers","üç§ Shrimp Stir-Fry","ü•û Breakfast for Dinner","ü•î Baked Potatoes","üç£ Sushi Night","üåØ Burritos","ü•ò Chili","üçú Ramen","ü•ô Pita & Hummus","üçñ BBQ Chicken","ü•¶ Veggie Stir-Fry","üßÜ Meatballs","ü•© Steak & Veg","ü•ß Pot Pie","üçö Fried Rice","üßÄ Mac & Cheese","üêü Baked Fish","ü•ö Omelets","üç≤ Chicken Noodle Soup","ü•í Snack Plate","üåÆ Taco Salad","üåØ Quesadillas","üçù Penne & Marinara","ü•ó Greek Salad","üçñ Pulled Pork","üçó Roasted Chicken","üçù Alfredo Pasta","ü•™ BLT","üå∂Ô∏è Fajitas","üçñ Ribs","üçù Lasagna","ü•ó Cobb Salad","üçõ Butter Chicken","ü•ò Paella","üçö Teriyaki Bowls","üç† Sweet Potatoes","ü•® Pretzel Dogs","ü•™ Grilled Cheese","üç§ Popcorn Shrimp","üçï Flatbreads"]; save(LS.foods,foods) }
  let desserts=load(LS.desserts,null); if(!Array.isArray(desserts)||desserts.length<3){ desserts=["üç™ Cookies","üç® Ice Cream","üç∞ Cake","üçì Berries & Cream","ü•ß Pie","üç´ Brownies","üçÆ Pudding","üçé Apple Slices & PB"]; save(LS.desserts,desserts) }
  if(load(LS.pantry,null)==null){ save(LS.pantry,["salt","pepper","ketchup","mustard","olive oil","butter"]); }}

/* Day state */
const mISO=thisMondayISO(); let curIdx=todayIdxInWeek(mISO);
function curDayKey(){ return DAYS[curIdx]; }
function stripEmoji(txt){ return (txt||'').replace(/^[^\p{L}\p{N}]+/u,'').trim(); }

/* UI helpers */
function fillSelect(el,list,selected){ const ph='‚Äî Choose item ‚Äî'; const arr=[ph,...list];
  el.innerHTML=arr.map(v=>{const isPH=v===ph; const val=isPH?'':v; const sel=(val===selected)||(isPH&&!selected)?' selected':''; return `<option value="${val.replace(/&/g,'&amp;').replace(/</g,'&lt;')}">${v}</option>`;}).join('');
}
function dayLabelAndDate(){
  const start=new Date(mISO+'T00:00:00'); const d=new Date(start); d.setDate(d.getDate()+curIdx);
  const nice=d.toLocaleDateString(undefined,{month:'short',day:'numeric'}); // <- no weekday
  document.getElementById('dayLabel').textContent=curDayKey();
  document.getElementById('dateLabel').textContent=nice;
}

/* Header image decode with robust fallbacks */
async function readAndShrinkSmart(file, maxSide=1800, quality=.9){
  const bmp=await decodeToBitmap(file).catch(()=>null);
  if(!bmp) return null;
  const scale=Math.min(1,maxSide/Math.max(bmp.width,bmp.height));
  const w=Math.max(1,Math.round(bmp.width*scale)), h=Math.max(1,Math.round(bmp.height*scale));
  const c=document.createElement('canvas'); c.width=w; c.height=h;
  c.getContext('2d').drawImage(bmp,0,0,w,h);
  return c.toDataURL('image/jpeg',quality);
}
function decodeToBitmap(file){
  return new Promise((resolve,reject)=>{
    if('createImageBitmap' in window){ createImageBitmap(file).then(resolve).catch(()=>{
      const fr=new FileReader(); fr.onload=()=>{ const img=new Image(); img.onload=()=>resolve(img); img.onerror=reject; img.src=fr.result; }; fr.onerror=reject; fr.readAsDataURL(file); });
    }else{
      const fr=new FileReader(); fr.onload=()=>{ const img=new Image(); img.onload=()=>resolve(img); img.onerror=reject; img.src=fr.result; }; fr.onerror=reject; fr.readAsDataURL(file);
    }
  });
}
function readRawDataURL(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }

/* Render current day */
function renderDay(){
  document.getElementById('weekLabel').textContent=weekLabelText(mISO);
  dayLabelAndDate();
  const plan=loadWeekPlan(mISO);
  const x=plan.days[curDayKey()]||emptyDay();

  // hero
  const heroBox=document.getElementById('hero'); const hero=document.getElementById('heroImg');
  if(x.hero){ hero.src=x.hero; heroBox.classList.remove('empty'); }
  else { hero.removeAttribute('src'); heroBox.classList.add('empty'); }

  const foods=load(LS.foods,[]), desserts=load(LS.desserts,[]);
  fillSelect(document.getElementById('kidsMain'), foods, x.kids.main);
  fillSelect(document.getElementById('kidsSide'), foods, x.kids.side);
  fillSelect(document.getElementById('parentsMain'), foods, x.parents.main);
  fillSelect(document.getElementById('parentsSide'), foods, x.parents.side);
  fillSelect(document.getElementById('dessertSel'), desserts, x.dessert);
  document.getElementById('dessertSel').style.display = x.dessert ? '' : 'none';
  document.getElementById('btnDessert').textContent  = x.dessert ? 'Remove dessert' : 'Add dessert';
  document.getElementById('rateSel').value=(x.rating==null)?'':String(x.rating);

  // notes badge
  const n=getNotes();
  const has=[x.kids.main,x.kids.side,x.parents.main,x.parents.side,x.dessert].filter(Boolean).some(l=>!!(n[l]&&(n[l].global||'').trim()));
  document.getElementById('btnDayNotes').setAttribute('data-hasnotes',String(has));
}

/* Wire inputs */
function mutateDay(fn){ const p=loadWeekPlan(mISO); fn(p.days[curDayKey()]); save(LS.week(mISO),p); renderDay(); }
document.getElementById('kidsMain').onchange=()=>mutateDay(d=>d.kids.main=document.getElementById('kidsMain').value);
document.getElementById('kidsSide').onchange=()=>mutateDay(d=>d.kids.side=document.getElementById('kidsSide').value);
document.getElementById('parentsMain').onchange=()=>mutateDay(d=>d.parents.main=document.getElementById('parentsMain').value);
document.getElementById('parentsSide').onchange=()=>mutateDay(d=>d.parents.side=document.getElementById('parentsSide').value);
document.getElementById('btnDessert').onclick=()=>mutateDay(d=>{ d.dessert = d.dessert ? "" : ""; /* reveal select; choice happens on change */ document.getElementById('dessertSel').style.display=''; });
document.getElementById('dessertSel').onchange=()=>mutateDay(d=>d.dessert=document.getElementById('dessertSel').value);
document.getElementById('rateSel').onchange=()=>mutateDay(d=>d.rating=(document.getElementById('rateSel').value===''?null:parseInt(document.getElementById('rateSel').value,10)));

/* Header photo buttons */
document.getElementById('btnAddHero').onclick=()=>document.getElementById('heroPicker').click();
document.getElementById('btnRemoveHero').onclick=()=>mutateDay(d=>d.hero=null);
document.getElementById('heroPicker').onchange=async e=>{
  const f=(e.target.files||[])[0]; if(!f) return;
  let data = await readAndShrinkSmart(f,1800,.9).catch(()=>null);
  if(!data) data = await readRawDataURL(f).catch(()=>null);
  if(!data) data = URL.createObjectURL(f);
  mutateDay(d=>d.hero=data);
  e.target.value='';
};

/* Notes modal & editor ‚Äî unchanged from your last file (hooked to #btnDayNotes) */
const dayNotesModal = document.getElementById('dayNotesModal');
if(dayNotesModal){ /* keep existing implementation in your file */ }

/* Recipe search */
document.getElementById('btnRecipeSearch').onclick=()=>{
  const x=loadWeekPlan(mISO).days[curDayKey()];
  const terms=[x.kids.main,x.parents.main,x.kids.side,x.parents.side,x.dessert].filter(Boolean).map(stripEmoji);
  const q=(terms.join(' ')||'easy family dinner')+' recipes';
  window.open('https://www.google.com/search?q='+encodeURIComponent(q),'_blank');
};

/* Menu hamburger (unchanged logic) */
(function(){
  const btn=document.getElementById('btnHamburger'), dd=document.getElementById('menuDropdown');
  const open=()=>{dd.classList.add('open');btn.setAttribute('aria-expanded','true');dd.setAttribute('aria-hidden','false');};
  const close=()=>{dd.classList.remove('open');btn.setAttribute('aria-expanded','false');dd.setAttribute('aria-hidden','true');};
  btn.addEventListener('click',e=>{e.stopPropagation(); dd.classList.contains('open')?close():open();});
  document.addEventListener('click',e=>{ if(!dd.contains(e.target)&&e.target!==btn) close(); });
  dd.addEventListener('click',e=>{
    const a=e.target.closest('.menu-item'); if(!a) return; close();
    const act=a.dataset.action, plan=loadWeekPlan(mISO);
    if(act==='reset'){ if(confirm('Clear all entries for this week?')){ const p={days:{}};DAYS.forEach(d=>p.days[d]=emptyDay()); save(LS.week(mISO),p); renderDay(); } }
    else if(act==='templates'){ openTemplates(); }
    else if(act==='groceries'){ openGroceries(); }
    else if(act==='shareGro'){ shareText(groceryText()); }
    else if(act==='sharePlan'){ shareText(planSummaryText()); }
    else if(act==='manage'){ openManage(); }
  });
})();

/* Manage/templates/groceries functions remain the same as your last version ‚Ä¶ */

/* Boot */
seedFoodsIfNeeded();
document.getElementById('weekLabel').textContent=weekLabelText(mISO);
renderDay();
document.getElementById('prevDay').onclick=()=>{curIdx=(curIdx+6)%7; renderDay();};
document.getElementById('nextDay').onclick=()=>{curIdx=(curIdx+1)%7; renderDay();};

window.addEventListener('pageshow', renderDay);
window.addEventListener('storage', e=>{
  if(!e.key) return;
  if(e.key.startsWith('dp:plan:')||e.key==='dp:foods:list'||e.key==='dp:desserts:list'||e.key==='dp:pantry'){ renderDay(); }
});

if('serviceWorker' in navigator) addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(()=>{}));
  </script>
</body>
</html>