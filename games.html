<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fambam ¬∑ Games</title>

<meta name="theme-color" content="#0f172a">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.webmanifest">

<link rel="stylesheet" href="wallpaper.css">
<link rel="stylesheet" href="fambam.css">
<script src="wallpaper.js" defer></script>

<style>
.page-games .app{max-width:1100px;margin:0 auto;padding:20px;display:grid;gap:18px}
.header .title{font-weight:800}
.panel.soft{background:var(--card);border:1px solid var(--panelBorder);border-radius:16px;padding:12px}

/* game cards grid ‚Äì simple squares */
.games-grid{display:grid;gap:14px;grid-template-columns:repeat(2,minmax(0,1fr))}
@media(min-width:860px){.games-grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
.game-tile{
  display:grid; place-items:center; gap:10px; text-decoration:none; color:inherit;
  aspect-ratio:1/1; background:var(--card); border:1px solid var(--panelBorder); border-radius:16px;
}
.game-tile .icon{line-height:1;font-size:clamp(56px,12vw,112px)}
.game-tile .name{font-weight:800}

/* leaderboard */
.table{width:100%;border-collapse:separate;border-spacing:0 6px}
.table th{font-weight:700;text-align:left;opacity:.85;padding:4px 8px}
.table td{background:var(--card);border:1px solid var(--panelBorder);padding:10px;border-radius:10px}
.table td:not(:first-child){border-left:0}
.pill{padding:6px 10px;border:1px solid var(--chipBorder);border-radius:999px;background:var(--chipBg);cursor:pointer}
.pill[aria-pressed="true"]{background:var(--accent);color:#001018;border-color:transparent;font-weight:800}
.btn{background:var(--chipBg);border:1px solid var(--chipBorder);border-radius:10px;padding:8px 10px;color:var(--text);cursor:pointer}
.right{margin-left:auto}
.small{font-size:.9rem;color:var(--muted)}
</style>

<script>
/* theme + header float (respects Admin setting) */
(function(){
  function applyTheme(t){const m=(t&&t.mode==='light')?'light':'dark', a=(t&&t.accent)||'#22d3ee';
    document.documentElement.setAttribute('data-theme',m);
    document.documentElement.style.setProperty('--accent',a);
    const meta=document.querySelector('meta[name="theme-color"]');
    if(meta) meta.setAttribute('content', m==='light'?'#f2efe7':'#0f172a');
  }
  try{applyTheme(JSON.parse(localStorage.getItem('ui:theme')||'null')||{mode:'dark',accent:'#22d3ee'})}catch{}
  function applyHeader(){try{
    const on = !!JSON.parse(localStorage.getItem('ui:headerFloat')||'false');
    document.body.classList.toggle('header-float', on);
  }catch{}}
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded',applyHeader,{once:true}); else applyHeader();
  window.addEventListener('storage',e=>{
    if(e.key==='ui:theme'){try{applyTheme(JSON.parse(e.newValue||'{}'))}catch{}}
    if(e.key==='ui:headerFloat') applyHeader();
  });
})();
</script>
</head>

<body class="page-games">
  <div class="app">
    <header class="panel header app-header">
      <a href="./index.html" class="brand" title="Home"><img src="fambam.png" alt="Fambam"></a>
      <div class="title">Games</div>

      <div class="menu-wrap">
        <button class="hamburger" id="menuBtn" aria-label="Menu"><span class="small" aria-hidden="true">‚â°</span></button>
        <div class="menu-dd" id="mainMenu" role="menu">
          <button class="mi" id="miExport">Export scores (CSV)</button>
          <div class="hr" style="height:1px;background:var(--panelBorder);margin:6px 0"></div>
          <button class="mi" id="miReset">Reset all scores</button>
        </div>
      </div>
    </header>

    <!-- Grid of game choices (navigate to page) -->
    <section class="panel soft">
      <div style="font-weight:800;margin-bottom:8px">Pick a game</div>
      <div class="games-grid">
        <a class="game-tile" href="games/tic-tac-toe.html">
          <div class="icon">‚ùå‚≠ï</div><div class="name">Tic-Tac-Toe</div>
        </a>
        <a class="game-tile" href="games/flappy.html">
          <div class="icon">üê¶</div><div class="name">Flappy (demo)</div>
        </a>
      </div>
    </section>

    <!-- Leaderboard (reads localStorage from game pages) -->
    <section class="panel soft">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
        <div style="font-weight:800">Leaderboards</div>
        <div class="pill" id="tabAll" aria-pressed="true">All-time</div>
        <div class="pill" id="tabPer" aria-pressed="false">Per-game</div>
        <select id="lbGameSel" class="btn right" style="display:none">
          <option value="tictactoe">Tic-Tac-Toe</option>
          <option value="flappy">Flappy (demo)</option>
        </select>
      </div>
      <table class="table">
        <thead><tr><th>Player</th><th>Game</th><th>Score</th><th>When</th></tr></thead>
        <tbody id="lbBody"></tbody>
      </table>
    </section>

    <footer class="small" style="text-align:center;opacity:.75">Works offline. Data stays on this device (local only).</footer>
  </div>

<script>
/* ------- Scores (shared format) -------- */
const LS = { scores:g=>`gm:scores:${g}` };
const load=(k,f)=>{try{const v=JSON.parse(localStorage.getItem(k));return v??f}catch{return f}};
const GAMES = {
  tictactoe: {name:'Tic-Tac-Toe'},
  flappy:    {name:'Flappy (demo)'}
};

function allScores(){
  const rows=[];
  Object.keys(GAMES).forEach(id=>{
    (load(LS.scores(id),[])||[]).forEach(r=>rows.push({...r,gameId:id}));
  });
  return rows.sort((a,b)=>(b.ts||0)-(a.ts||0));
}
function paintLeaderboard(){
  const per = document.getElementById('tabPer').getAttribute('aria-pressed')==='true';
  const sel = document.getElementById('lbGameSel').value;
  const data = per ? allScores().filter(r=>r.gameId===sel) : allScores();
  const tb=document.getElementById('lbBody'); tb.innerHTML='';
  data.forEach(r=>{
    const best=[...(r.scores||[])].sort((a,b)=>b.points-a.points)[0];
    const who = best?best.name:(r.players||[]).map(p=>p.name).join(', ');
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${who||'‚Äî'}</td><td>${GAMES[r.gameId].name}</td><td>${best?best.points:'‚Äî'}</td><td class="small">${new Date(r.ts).toLocaleString()}</td>`;
    tb.appendChild(tr);
  });
}
document.getElementById('tabAll').onclick=()=>{tab(true)};
document.getElementById('tabPer').onclick=()=>{tab(false)};
function tab(all){
  document.getElementById('tabAll').setAttribute('aria-pressed', String(all));
  document.getElementById('tabPer').setAttribute('aria-pressed', String(!all));
  document.getElementById('lbGameSel').style.display = all ? 'none':'inline-block';
  paintLeaderboard();
}
document.getElementById('lbGameSel').onchange=paintLeaderboard;

/* menu */
(function(){
  const btn=document.getElementById('menuBtn'), dd=document.getElementById('mainMenu');
  btn.onclick=()=> dd.style.display = (dd.style.display==='block'?'none':'block');
  document.addEventListener('click',(e)=>{ if(!dd.contains(e.target) && e.target!==btn){ dd.style.display='none'; }});
  document.getElementById('miExport').onclick=exportCSV;
  document.getElementById('miReset').onclick=()=>{ if(confirm('Reset all game scores?')){ Object.keys(GAMES).forEach(id=>localStorage.removeItem(LS.scores(id))); paintLeaderboard(); } };
})();
function exportCSV(){
  const rows=[['game','timestamp','player_id','player_name','points']];
  allScores().forEach(r=>{
    (r.scores||[]).forEach(s=>{
      rows.push([GAMES[r.gameId].name, new Date(r.ts).toISOString(), s.id, s.name, s.points]);
    });
  });
  const csv = rows.map(r=>r.map(String).map(x=>x.includes(',')?`"${x.replace(/"/g,'""')}"`:x).join(',')).join('\n');
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download='fambam-games-scores.csv'; a.click();
  URL.revokeObjectURL(a.href);
}

/* boot */
document.addEventListener('DOMContentLoaded', paintLeaderboard);
</script>
</body>
</html>